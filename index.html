<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Plantillas HTML - Signaturit</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- ═══════════════════════════════════ -->
    <!-- Vista 1: LOGIN                      -->
    <!-- ═══════════════════════════════════ -->
    <div id="viewLogin" class="view">
        <div class="login-wrapper">
            <div class="login-card">
                <div class="login-logo">S</div>
                <h1>Signaturit Template Generator</h1>
                <p class="login-subtitle">Conecta tu cuenta para gestionar los brandings y templates de email</p>

                <div class="form-group">
                    <label>Entorno</label>
                    <select id="apiEnvironment">
                        <option value="sandbox">Sandbox (pruebas)</option>
                        <option value="production">Production</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Access Token</label>
                    <input type="password" id="apiToken" placeholder="Pega aquí tu bearer token de Signaturit">
                </div>

                <button class="btn-login" id="btnConnect" onclick="connectAPI()">
                    Conectar
                </button>

                <div id="loginError" class="login-error" style="display:none;"></div>
            </div>
        </div>
    </div>

    <!-- ═══════════════════════════════════ -->
    <!-- Vista 2: DASHBOARD                  -->
    <!-- ═══════════════════════════════════ -->
    <div id="viewDashboard" class="view" style="display:none;">
        <div class="dashboard">
            <header class="dashboard-header">
                <div class="dashboard-header-left">
                    <h1>Mis Brandings</h1>
                    <div class="dashboard-status">
                        <span class="status-dot"></span>
                        <span id="dashboardEnv">Sandbox</span>
                        &mdash;
                        <span id="dashboardCount">0</span> brandings
                    </div>
                </div>
                <div class="dashboard-header-right">
                    <button class="btn-new-branding" onclick="goToEditorNew()">+ Nuevo Branding</button>
                    <button class="btn-disconnect" onclick="disconnectAPI()">Desconectar</button>
                </div>
            </header>

            <div id="brandingsGrid" class="brandings-grid"></div>

            <div id="pagination" class="pagination"></div>
        </div>
    </div>

    <!-- ═══════════════════════════════════ -->
    <!-- Vista 3: EDITOR                     -->
    <!-- ═══════════════════════════════════ -->
    <div id="viewEditor" class="view" style="display:none;">
        <div class="editor-container">
            <!-- ── Panel de Controles ── -->
            <div class="controls">
                <div class="editor-topbar">
                    <button class="btn-back" onclick="goToDashboard()">&larr; Brandings</button>
                    <div class="editor-branding-info">
                        <input type="text" class="editor-branding-name-input" id="editorBrandingName" value="Nuevo Branding" placeholder="Nombre del branding" maxlength="40">
                        <span class="editor-branding-id" id="editorBrandingId" onclick="copyBrandingId()" title="Click para copiar ID"></span>
                    </div>
                </div>

                <!-- Sección: Template API -->
                <div class="collapsible-section">
                    <div class="collapsible-header active" onclick="toggleCollapsible(this)">
                        <h2>Template API</h2>
                        <span class="collapsible-icon">&#9660;</span>
                    </div>
                    <div class="collapsible-content active">
                        <div class="collapsible-inner">
                            <div class="form-group" id="newBrandingNameGroup" style="display: none;">
                                <label>Nombre del nuevo branding (max 24 chars)</label>
                                <input type="text" id="newBrandingName" placeholder="Mi Branding" maxlength="24">
                            </div>

                            <div class="form-group" id="templateTypeGroup">
                                <label>Tipo de Template</label>
                                <select id="templateType">
                                    <option value="sign_request">sign_request</option>
                                    <option value="signatures_request">signatures_request (requiere {{sign_button}})</option>
                                    <option value="signatures_receipt">signatures_receipt</option>
                                    <option value="request_expired">request_expired</option>
                                    <option value="pending_sign">pending_sign (requiere {{sign_button}})</option>
                                    <option value="document_canceled">document_canceled</option>
                                    <option value="emails_request">emails_request (requiere {{email_button}})</option>
                                    <option value="validation_request">validation_request (requiere {{validate_button}})</option>
                                    <option value="signed_document">signed_document</option>
                                    <option value="document_declined">document_declined</option>
                                    <option value="request_expired_requester">request_expired_requester</option>
                                </select>
                            </div>

                            <div class="api-button-row">
                                <button class="btn-api-action btn-api-load" onclick="loadTemplateFromAPI()">
                                    Cargar template
                                </button>
                                <button class="btn-api-action btn-api-save" onclick="saveTemplateToAPI()">
                                    Guardar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <h2>Variables</h2>
                <div class="info-box">
                    Incluye las <strong>14 variables oficiales de Signaturit</strong> + las tuyas personalizadas.
                </div>

                <button class="btn-open-modal" onclick="openVariableModal()">
                    Gestionar Variables
                    <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 12px;" id="variableCount">14</span>
                </button>

                <!-- Sección: Contenido del Email -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        <h2>Contenido del Email</h2>
                        <span class="collapsible-icon">&#9660;</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="collapsible-inner">
                            <div class="form-group">
                                <label>URL del Logo</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="url" id="logoUrl" placeholder="https://ejemplo.com/logo.png" style="flex: 1;">
                                    <button class="btn-logo" onclick="insertLogoVariable()">Logo</button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Ancho del Logo (px o %)</label>
                                <input type="text" id="logoWidth" value="300px" placeholder="300px o 100%">
                            </div>

                            <div class="form-group">
                                <label>Alto del Logo (px, % o auto)</label>
                                <input type="text" id="logoHeight" value="auto" placeholder="auto, 100px o 50%">
                            </div>

                            <div class="form-group">
                                <label>Ajuste de Imagen (object-fit)</label>
                                <select id="logoObjectFit">
                                    <option value="none">Ninguno (por defecto)</option>
                                    <option value="contain">Contain - Ajustar sin recortar</option>
                                    <option value="cover">Cover - Llenar recortando</option>
                                    <option value="fill">Fill - Estirar para llenar</option>
                                    <option value="scale-down">Scale Down - Reducir si es necesario</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Contenido Completo del Email</label>
                                <textarea id="emailContent" style="min-height: 300px;" placeholder="Escribe aquí el contenido de tu email...&#10;&#10;Ejemplo:&#10;Estimado/a {{signer_name}}, le hacemos llegar la documentación:&#10;&#10;{{filename}}&#10;&#10;Para firmar, haga clic en: {{sign_button}}&#10;&#10;{{email_body}}"></textarea>
                            </div>

                            <div class="form-group">
                                <label>Variables Disponibles (Haz clic para insertar)</label>
                                <div class="variables-inline" id="variablesInline"></div>
                                <button class="btn-manage-vars" onclick="openVariableModal()">
                                    Gestionar Variables
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección: Colores Generales -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        <h2>Colores Generales</h2>
                        <span class="collapsible-icon">&#9660;</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="collapsible-inner">
                            <div class="form-group">
                                <label>Color de Fondo Principal</label>
                                <div class="color-input">
                                    <input type="color" id="bgColor" value="#ffffff">
                                    <input type="text" class="color-value" id="bgColorValue" value="#ffffff">
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-top: 8px;">
                                    <label style="margin: 0; font-size: 12px; min-width: 80px;">Opacidad:</label>
                                    <input type="range" id="bgColorOpacity" min="0" max="1" step="0.01" value="1" style="flex: 1;">
                                    <span id="bgColorOpacityValue" style="font-size: 12px; min-width: 35px;">100%</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Color del Contenedor</label>
                                <div class="color-input">
                                    <input type="color" id="containerColor" value="#ffffff">
                                    <input type="text" class="color-value" id="containerColorValue" value="#ffffff">
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-top: 8px;">
                                    <label style="margin: 0; font-size: 12px; min-width: 80px;">Opacidad:</label>
                                    <input type="range" id="containerColorOpacity" min="0" max="1" step="0.01" value="1" style="flex: 1;">
                                    <span id="containerColorOpacityValue" style="font-size: 12px; min-width: 35px;">100%</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Color del Borde del Contenedor</label>
                                <div class="color-input">
                                    <input type="color" id="borderColor" value="#cccccc">
                                    <input type="text" class="color-value" id="borderColorValue" value="#cccccc">
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-top: 8px;">
                                    <label style="margin: 0; font-size: 12px; min-width: 80px;">Opacidad:</label>
                                    <input type="range" id="borderColorOpacity" min="0" max="1" step="0.01" value="1" style="flex: 1;">
                                    <span id="borderColorOpacityValue" style="font-size: 12px; min-width: 35px;">100%</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Color del Texto</label>
                                <div class="color-input">
                                    <input type="color" id="textColor" value="#153643">
                                    <input type="text" class="color-value" id="textColorValue" value="#153643">
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-top: 8px;">
                                    <label style="margin: 0; font-size: 12px; min-width: 80px;">Opacidad:</label>
                                    <input type="range" id="textColorOpacity" min="0" max="1" step="0.01" value="1" style="flex: 1;">
                                    <span id="textColorOpacityValue" style="font-size: 12px; min-width: 35px;">100%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección: Estilo del Botón -->
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        <h2>Estilo del Boton</h2>
                        <span class="collapsible-icon">&#9660;</span>
                    </div>
                    <div class="collapsible-content">
                        <div class="collapsible-inner">
                            <div class="form-group">
                                <label>Color de Fondo del Boton</label>
                                <div class="color-input">
                                    <input type="color" id="buttonColor" value="#070707">
                                    <input type="text" class="color-value" id="buttonColorValue" value="#070707">
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-top: 8px;">
                                    <label style="margin: 0; font-size: 12px; min-width: 80px;">Opacidad:</label>
                                    <input type="range" id="buttonColorOpacity" min="0" max="1" step="0.01" value="1" style="flex: 1;">
                                    <span id="buttonColorOpacityValue" style="font-size: 12px; min-width: 35px;">100%</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Color del Texto del Boton</label>
                                <div class="color-input">
                                    <input type="color" id="buttonTextColor" value="#ffffff">
                                    <input type="text" class="color-value" id="buttonTextColorValue" value="#ffffff">
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-top: 8px;">
                                    <label style="margin: 0; font-size: 12px; min-width: 80px;">Opacidad:</label>
                                    <input type="range" id="buttonTextColorOpacity" min="0" max="1" step="0.01" value="1" style="flex: 1;">
                                    <span id="buttonTextColorOpacityValue" style="font-size: 12px; min-width: 35px;">100%</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Color del Borde del Boton</label>
                                <div class="color-input">
                                    <input type="color" id="buttonBorderColor" value="#070707">
                                    <input type="text" class="color-value" id="buttonBorderColorValue" value="#070707">
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px; margin-top: 8px;">
                                    <label style="margin: 0; font-size: 12px; min-width: 80px;">Opacidad:</label>
                                    <input type="range" id="buttonBorderColorOpacity" min="0" max="1" step="0.01" value="1" style="flex: 1;">
                                    <span id="buttonBorderColorOpacityValue" style="font-size: 12px; min-width: 35px;">100%</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Grosor del Borde (px)</label>
                                <input type="number" id="buttonBorderWidth" value="0" min="0" max="10">
                            </div>

                            <div class="form-group">
                                <label>Radio del Borde (px)</label>
                                <input type="number" id="buttonBorderRadius" value="20" min="0" max="50">
                            </div>

                            <div class="form-group">
                                <label>Padding (Top, Right, Bottom, Left en px)</label>
                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                                    <input type="number" id="buttonPaddingTop" value="15" min="0" max="50" placeholder="Top">
                                    <input type="number" id="buttonPaddingRight" value="15" min="0" max="50" placeholder="Right">
                                    <input type="number" id="buttonPaddingBottom" value="15" min="0" max="50" placeholder="Bottom">
                                    <input type="number" id="buttonPaddingLeft" value="15" min="0" max="50" placeholder="Left">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Margin (Top, Right, Bottom, Left en px)</label>
                                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                                    <input type="number" id="buttonMarginTop" value="10" min="0" max="50" placeholder="Top">
                                    <input type="number" id="buttonMarginRight" value="0" min="0" max="50" placeholder="Right">
                                    <input type="number" id="buttonMarginBottom" value="10" min="0" max="50" placeholder="Bottom">
                                    <input type="number" id="buttonMarginLeft" value="0" min="0" max="50" placeholder="Left">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Ancho del Boton (px)</label>
                                <input type="number" id="buttonWidth" value="200" min="100" max="400">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botones de accion -->
                <div class="button-group">
                    <button class="btn-primary" onclick="downloadHTML()">Descargar</button>
                    <button class="btn-secondary" onclick="resetToDefault()">Reset</button>
                    <button class="btn-secondary" onclick="document.getElementById('importHTML').click()">Importar</button>
                    <button class="btn-secondary" onclick="openPasteHTMLModal()">Pegar HTML</button>
                    <input type="file" id="importHTML" accept=".html,.htm" style="display:none;" onchange="importHTMLFile(event)">
                </div>

                <div class="form-group" style="margin-top: 15px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="minifyHTML" checked style="width: auto; cursor: pointer;">
                        <span>Minificar HTML (para API - quita espacios)</span>
                    </label>
                    <small style="color: #6c757d; display: block; margin-top: 5px;">
                        Recomendado para envio via API. Reduce el tamano del HTML.
                    </small>
                </div>
            </div>

            <!-- ── Preview ── -->
            <div class="preview-section">
                <div class="preview-toolbar">
                    <span class="preview-toolbar-title">Vista previa</span>
                    <div class="preview-toolbar-actions">
                        <button class="toolbar-btn" onclick="updatePreview()">Refrescar</button>
                        <button class="toolbar-btn toolbar-btn-primary" onclick="copyToClipboard()">Copiar HTML</button>
                    </div>
                </div>

                <div class="preview" id="previewContainer">
                    <div class="preview-frame" id="previewFrame"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <!-- Modal de Variables -->
    <div class="modal" id="variableModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gestionar Variables</h2>
                <button class="close-modal" onclick="closeVariableModal()">&times;</button>
            </div>

            <div class="variable-hint">
                <strong>Tip:</strong> Haz clic en una variable para insertarla. Pasa el mouse sobre cada una para ver su descripcion.
            </div>

            <div class="variables-grid" id="variablesGrid"></div>

            <div class="add-variable-form">
                <input type="text" id="newVariableName" placeholder="nombre_variable" onkeypress="handleVariableKeyPress(event)">
                <button class="btn-small btn-add" onclick="addVariableFromModal()">Agregar</button>
            </div>
        </div>
    </div>

    <!-- Modal Pegar HTML -->
    <div class="modal" id="pasteHTMLModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Pegar HTML</h2>
                <button class="close-modal" onclick="closePasteHTMLModal()">&times;</button>
            </div>

            <div class="variable-hint">
                <strong>Pega aqui cualquier HTML de email</strong>
                <br><br>
                <strong>Acepta:</strong> Cualquier formato de HTML de email, con o sin estructura especifica
                <br>
                <strong>No pegues:</strong> El codigo del generador mismo
            </div>

            <div style="margin: 20px 0;">
                <textarea id="pasteHTMLTextarea" placeholder="Pega aqui tu codigo HTML..." style="width: 100%; min-height: 400px; font-family: 'Courier New', monospace; font-size: 13px; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px;"></textarea>
            </div>

            <div style="text-align: right; margin-top: 15px;">
                <button class="btn-secondary" onclick="closePasteHTMLModal()" style="margin-right: 10px;">Cancelar</button>
                <button class="btn-primary" onclick="loadPastedHTML()">Cargar HTML</button>
            </div>
        </div>
    </div>

    <!-- Modal Confirmar Push a API -->
    <div class="modal" id="confirmPushModal">
        <div class="modal-content" style="max-width: 480px;">
            <div class="modal-header">
                <h2>Confirmar envio a API</h2>
                <button class="close-modal" onclick="closeConfirmPushModal()">&times;</button>
            </div>

            <div class="confirm-push-details" id="confirmPushDetails"></div>

            <div class="confirm-push-buttons">
                <button class="btn-secondary" onclick="closeConfirmPushModal()">Cancelar</button>
                <button class="btn-confirm-push" id="btnConfirmPush" onclick="executeConfirmedPush()">Confirmar y Enviar</button>
            </div>
        </div>
    </div>

    <script src="app.js?v=4"></script>
</body>
</html>
